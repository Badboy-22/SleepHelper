async function whoAmI(){const r=await fetch("/api/auth/me",{credentials:"include"});if(!r.ok)return null;const{user}=await r.json().catch(()=>({user:null}));return user||null}function fmtTime(s){if(!s)return"";return s.includes("T")?s.replace("T"," ").slice(0,16):s}async function loadFor(d){document.getElementById("title-schedule").textContent=`${d} 스케줄`;const s=await fetch(`/api/schedule?date=${d}`).then(r=>r.json());const ulS=document.getElementById("schedule-list");ulS.innerHTML=s.items&&s.items.length?"":"<li>일정 없음</li>";(s.items||[]).forEach(it=>{const li=document.createElement("li");li.textContent=`${fmtTime(it.start)} ~ ${fmtTime(it.end)} · ${it.title||""}`;ulS.appendChild(li)});const f=await fetch(`/api/fatigue?date=${d}`).then(r=>r.json());const ulF=document.getElementById("fatigue-list");ulF.innerHTML=f.items&&f.items.length?"":"<li>기록 없음</li>";(f.items||[]).forEach(it=>{const li=document.createElement("li");const t=new Date(it.recordedAt);li.textContent=`${t.toLocaleTimeString()} · ${it.type} · ${it.value}`;ulF.appendChild(li)})}document.addEventListener("DOMContentLoaded",async()=>{const me=await whoAmI();if(!me){location.href="/login.html";return}const day=document.getElementById("day");const today=new Date().toISOString().slice(0,10);day.value=today;await loadFor(day.value);day.addEventListener("change",()=>loadFor(day.value));document.getElementById("logout").addEventListener("click",async()=>{await fetch("/api/auth/logout",{method:"POST"});location.href="/login.html"})});